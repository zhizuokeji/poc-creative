# 系统提示词数据格式规范修改完成

**完成时间**: 2025-06-28 12:00  
**任务概述**: 成功修改系统提示词，实现统一的JSON数据格式规范，确保各阶段数据结构一致性

## 修改概述

本次修改完成了文章生成系统中**所有8个阶段**系统提示词的重大重构，实现了以下核心目标：

### 1. 数据格式统一

- **大模型输入输出**：所有阶段统一使用纯JSON格式，不再使用markdown内嵌json的混合格式
- **测试代码数据**：使用YAML格式进行序列化/反序列化，便于人类阅读和调试验证
- **生产代码数据**：统一使用Kotlin data class对象处理数据，避免字符串拼接和手动解析

### 2. 文章内容结构化

- **章节列表结构**：从写作阶段开始，文章内容采用结构化的章节列表格式
- **渐进式完善**：各阶段支持在前一阶段基础上添加新字段（如配图描述、配图路径）
- **统一数据模型**：定义了ArticleContent统一数据结构，确保各阶段兼容性

## 详细修改内容

### 1. 创建统一数据结构规范

**文件**: `workspace/instructions/JSON数据结构规范.md`

- 定义了统一的ArticleContent数据结构
- 明确了各阶段的JSON schema要求
- 提供了向后兼容性保证
- 包含了测试代码的YAML处理和Markdown生成指南

### 2. 修改构思阶段系统提示词

**文件**: `workspace/instructions/3. 构思阶段.md`

**主要变更**：

- 输出格式改为纯JSON，包含title、description、outline等结构化数据
- 添加了数据格式说明，明确测试代码处理流程
- 更新了示例，展示完整的JSON输出格式
- 强调了纯JSON输出的重要性

### 3. 修改写作阶段系统提示词

**文件**: `workspace/instructions/4. 写作阶段.md`

**主要变更**：

- 输出格式改为JSON，包含title、description、metadata、sections数组
- 定义了sections的结构：title、content、level、order等字段
- 预留了imageDescription和imagePath字段供后续阶段使用
- 提供了完整的JSON输出示例，包含实际的文章内容

### 4. 修改配图执行阶段系统提示词

**文件**: `workspace/instructions/7. 配图执行阶段.md`

**主要变更**：

- 输入格式改为JSON，不再使用Markdown注释
- 输出格式为JSON，在sections中添加imagePath字段
- 明确了图片文件处理要求：独立文件保存、有意义命名、相对路径
- 强调了图片文件与JSON数据的正确关联

### 5. 修改优化阶段系统提示词

**文件**: `workspace/instructions/5. 优化阶段.md`

**主要变更**：

- 输入输出格式统一为JSON，保持与写作阶段相同的数据结构
- 在metadata中添加optimizations字段记录具体的优化项
- 明确了优化记录的格式：type、category、description、section、reason
- 强调了内容优化的同时保持原意和风格一致性

### 6. 修改配图计划阶段系统提示词

**文件**: `workspace/instructions/6. 配图计划阶段.md`

**主要变更**：

- 输入输出格式统一为JSON
- 在sections中为每个章节添加imageDescription字段
- 明确了配图描述的格式要求：内容、风格、色彩、构图、关键元素
- 强调了配图规划原则：一个标题一张图、内容相关性、视觉统一性

### 7. 修改配图执行阶段为程序自动化处理

**文件**: `workspace/instructions/7. 配图执行阶段.md`

**主要变更**：

- 删除了要求大模型输出JSON的部分，改为程序执行说明
- 明确此阶段由程序自动执行：图片搜索、下载、保存和路径更新
- 详细说明了程序执行步骤：解析配图需求、构建搜索查询、调用图像服务、下载图片文件、更新JSON数据
- 添加了程序实现指导：图像搜索策略、版权合规、错误处理、质量保证、日志监控
- 强调测试代码中程序执行结果仍需序列化为YAML格式，便于人类检查

### 8. 修改完成阶段为程序自动化处理

**文件**: `workspace/instructions/8. 完成阶段.md`

**主要变更**：

- 删除了要求大模型输出JSON的部分，改为程序执行说明
- 明确此阶段由程序自动执行：生成最终Markdown文件，处理格式化工作
- 详细说明了程序执行步骤：数据验证预处理、元数据处理、Markdown文件生成、文件输出保存
- 添加了程序实现指导：Markdown生成策略、文件管理、质量保证
- 提供了完整的程序输入输出示例，展示JSON到Markdown的转换过程
- 强调测试代码中程序生成的最终结果仍需保存为YAML格式，便于人类检查

## 技术实现要点

### 1. JSON Schema设计

```json
{
  "title": "文章标题",
  "description": "文章简介",
  "metadata": {
    "author": "作者姓名",
    "createdAt": "ISO时间格式",
    "estimatedReadingTime": 10,
    "wordCount": 2500,
    "tags": ["标签数组"],
    "category": "文章分类",
    "language": "zh-CN"
  },
  "sections": [
    {
      "title": "章节标题（可选）",
      "content": "章节内容（必填）",
      "imageDescription": "配图描述（可选）",
      "imagePath": "图片路径（可选）",
      "level": 2,
      "order": 1
    }
  ]
}
```

### 2. 渐进式字段完善

- **构思阶段**：输出outline结构，为后续阶段提供框架
- **写作阶段**：sections包含title、content、level、order
- **优化阶段**：保持相同结构，在metadata中添加optimizations记录
- **配图计划阶段**：添加imageDescription字段
- **配图执行阶段**：添加imagePath字段
- **完成阶段**：完善metadata中的所有字段（author、seoKeywords等）

### 3. 测试代码处理流程

1. **大模型输出**：纯JSON格式
2. **YAML序列化**：使用Jackson YAML保存为测试文件
3. **Markdown生成**：根据JSON数据生成预览文件
4. **人工干预**：支持编辑YAML文件后继续下一阶段

## 兼容性保证

### 1. 向后兼容原则

- 只能新增可选字段，不能删除或重命名现有字段
- 不能改变现有字段的数据类型
- 新增字段必须有合理的默认值

### 2. 版本管理

- 在metadata中可添加schemaVersion字段进行版本标识
- 支持多版本schema的并存和迁移

## 预期效果

### 1. 开发效率提升

- 统一的数据格式减少了格式转换的复杂性
- 结构化的数据便于代码处理和验证
- 清晰的schema定义减少了开发错误

### 2. 测试和调试便利

- YAML格式便于人类阅读和编辑
- 分阶段的数据保存支持精细化调试
- 预览文件生成便于内容验证

### 3. 系统可维护性

- 统一的数据结构便于系统扩展
- 向后兼容性保证了系统升级的平滑性
- 清晰的文档便于团队协作

## 后续工作建议

### 1. 代码实现更新

- 更新SimpleArticleCreator类以支持新的JSON格式
- 修改测试代码以使用新的数据结构
- 添加JSON schema验证逻辑

### 2. 其他阶段完善

- 考虑对创意阶段、选题阶段等前期阶段也进行JSON格式化
- 统一所有阶段的数据格式规范

### 3. 文档维护

- 定期更新JSON数据结构规范文档
- 添加更多的使用示例和最佳实践

## 质量保证

### 1. 格式验证

- 所有系统提示词都明确要求输出纯JSON格式
- 提供了完整的JSON schema示例
- 强调了数据格式的重要性

### 2. 一致性检查

- 各阶段的数据结构保持一致
- 字段命名和类型定义统一
- 示例数据格式规范

### 3. 文档完整性

- 每个阶段都有详细的数据格式说明
- 提供了完整的输入输出示例
- 包含了技术实现指导

## 总结

本次系统提示词修改成功实现了**全部8个阶段**数据格式的统一化和规范化，为文章生成系统的进一步发展奠定了坚实的基础。通过采用纯JSON格式和结构化的章节列表，系统的可维护性、可扩展性和用户体验都得到了显著提升。

### 完成的阶段修改

1. ✅ **构思阶段** - 大模型输出纯JSON格式，包含outline结构
2. ✅ **写作阶段** - 大模型输出JSON格式的结构化章节列表
3. ✅ **优化阶段** - 大模型输出JSON格式，添加优化记录
4. ✅ **配图计划阶段** - 大模型输出JSON格式，添加imageDescription字段
5. ✅ **配图执行阶段** - **程序自动化处理**，图片搜索下载和路径更新
6. ✅ **完成阶段** - **程序自动化处理**，生成最终Markdown文件

### 处理方式分类

**大模型参与阶段（1-6步）**：

- 构思、写作、优化、配图计划阶段由大模型处理，输出纯JSON格式
- 测试代码将JSON序列化为YAML格式，便于人类阅读和干预

**程序自动化阶段（7-8步）**：

- 配图执行、完成阶段由程序自动化处理，不需要大模型参与
- 程序处理结果仍保存为YAML格式，支持人类检查和调整

修改后的系统提示词不仅满足了当前的功能需求，还为未来的功能扩展预留了充分的空间，体现了良好的软件设计原则。

### 关键改进

1. **明确分工**：前6个阶段由大模型处理，后2个阶段由程序自动化处理
2. **数据一致性**：所有阶段都使用统一的JSON数据格式
3. **人工干预**：测试代码支持YAML序列化，便于人类检查和调整
4. **错误处理**：程序自动化阶段包含完善的错误处理和日志记录
5. **质量保证**：每个阶段都有明确的质量标准和验证机制

这种设计既保证了AI生成内容的质量，又通过程序自动化提高了处理效率，同时为人工干预和质量控制预留了充分的空间。
